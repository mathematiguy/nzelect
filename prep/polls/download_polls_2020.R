#=====================polls pre 2020 election===================================
url <- "https://en.wikipedia.org/wiki/Opinion_polling_for_the_2020_New_Zealand_general_election"

webpage <- url %>%
    read_html(encoding = "UTF-8")

tabs <- webpage %>%
    html_nodes("table")

# number below depends on the webpage...
tab <- html_table(tabs[[1]], fill = TRUE)

# knock out the historical commentaries:
tab <- tab[tab[ , 2] != tab[ , 3], 1:12]

tab <- tab[tab[, 1] != "Date[nb 1]", ]

names(tab)[1] <- "WikipediaDates"

tab$StartDate <-
    as.Date(
        c("17/10/2020",
          "8/10/2020",
          "10/10/2020",
          "3/10/2020",
          "1/9/2020",
          "23/9/2020",
          "16/9/2020",
          "17/9/2020",
          "1/8/2020",
          "1/7/2020",
          "25/7/2020",
          "16/7/2020",
          "1/6/2020",
          "20/6/2020",
          "27/4/2020",
          "16/5/2020",
          "8/5/2020",
          "1/4/2020",
          "1/3/2020",
          "1/2/2020",
          "8/2/2020",
          "23/1/2020",
          "1/1/2020",
          "23/11/2019",
          "7/11/2019",
          "5/10/2019",
          "2/10/2019",
          "20/7/2019",
          "4/6/2019",
          "30/5/2019",
          "6/4/2019",
          "15/3/2019",
          "9/2/2019",
          "24/1/2019",
          "24/11/2018",
          "15/10/2018",
          "28/7/2018",
          "17/5/2018",
          "19/5/2018",
          "7/4/2018",
          "10/2/2018",
          "18/1/2018",
          "2/1/2018",
          "27/11/2017",
          "29/11/2017",
          "30/10/2017",
          "2/10/2017",
          "23/9/2017"),
        format = "%d/%m/%Y")

tab$EndDate <- as.Date(
    c("17/10/2020",
      "15/10/2020",
      "14/10/2020",
      "7/10/2020",
      "30/9/2020",
      "27/9/2020",
      "23/9/2020",
      "21/9/2020",
      "31/8/2020",
      "31/7/2020",
      "29/7/2020",
      "24/7/2020",
      "30/6/2020",
      "24/6/2020",
      "24/5/2020",
      "20/5/2020",
      "16/5/2020",
      "30/4/2020",
      "31/3/2020",
      "28/2/2020",
      "12/2/2020",
      "1/2/2020",
      "31/1/2020",
      "27/11/2019",
      "11/11/2019",
      "9/10/2019",
      "9/10/2019",
      "24/7/2019",
      "8/6/2019",
      "7/6/2019",
      "10/4/2019",
      "23/3/2019",
      "13/2/2019",
      "2/2/2019",
      "28/11/2018",
      "19/10/2018",
      "1/8/2018",
      "24/5/2018",
      "23/5/2018",
      "11/4/2018",
      "14/2/2018",
      "28/1/2018",
      "28/1/2018",
      "10/12/2017",
      "5/12/2017",
      "12/11/2017",
      "15/10/2017",
      "23/9/2017"), 
	  format = "%d/%m/%Y")


x <- names(tab)
names(tab) <- case_when(
    x == "NAT" ~ "National",
    x == "LAB" ~ "Labour",
    x == "NZF" ~ "NZ First",
    x == "GRN" ~ "Green",
    x == "MRI" ~ "Maori",
    x == "NCP" ~ "Conservative",
    x == "Polling organisation" ~ "Poll",
    TRUE ~ names(tab)
)

# we *should* collect sample size but for now it is a TODO
polls2020 <- tab[, !names(tab) %in% c("Sample size", "Lead")]
